<!DOCTYPE html>
<html>
<head>
    <title>Auto Reply Dashboard</title>
</head>
<body>

<h2>Auto Reply Dashboard</h2>
<p>âœ… You are logged in successfully</p>

<p><strong>Your API Key:</strong> {{ api_key }}</p>

<p>
  <strong>Plan:</strong>
  <span style="
    padding:4px 10px;
    border-radius:6px;
    background: {{ 'gold' if plan=='PRO' else '#eee' }};
    color: {{ 'black' if plan=='PRO' else '#555' }};
    font-weight:bold;
  ">
    {{ plan }}
  </span>
</p>

<hr>

<h3>Upgrade Plan</h3>

{% if plan == "FREE" %}
<button type="button" id="payBtn">Upgrade to PRO ðŸš€</button>
{% else %}
<p style="color:green;font-weight:bold;">âœ… You are PRO User</p>
{% endif %}

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
document.getElementById("payBtn").onclick = async function () {
    const res = await fetch("/create-order", { method: "POST" });
    const order = await res.json();

    const options = {
        key: "{{ razorpay_key_id }}",
        amount: order.amount,
        currency: "INR",
        order_id: order.id,
        name: "AutoReply PRO",
        description: "Upgrade to PRO",
        handler: function () {
            window.location.href = "/dashboard";
        }
    };

    const rzp = new Razorpay(options);
    rzp.open();   // ðŸ”¥ THIS opens popup, not redirect
};
</script>
<!-- ðŸ‘† THIS PART -->

<hr>

<textarea id="message" placeholder="Type a message..." rows="4" cols="50"></textarea><br><br>

<button id="sendBtn" type="button" onclick="sendMessage()">Send</button>
<p id="limitMsg" style="color:red;"></p>

<p><b>Reply:</b></p>
<div id="reply"></div>

<hr>

<h3>Recent Messages</h3>

{% for msg, rep in history %}
    <p><b>You:</b> {{ msg }}</p>
    <p><b>Bot:</b> {{ rep }}</p>
    <hr>
{% endfor %}

<br>
<a href="/logout">Logout</a>

<script>
async function sendMessage() {

    const btn = document.getElementById("sendBtn");
    const msg = document.getElementById("message").value.trim();
    if (!msg) return;

    const res = await fetch("/api/auto-reply", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "X-API-KEY": "{{ api_key }}"
        },
        body: JSON.stringify({ message: msg })
    });

    const data = await res.json();

    if (data.error) {
        document.getElementById("limitMsg").innerText = data.error;
        btn.disabled = true;
        btn.innerText = "Limit Reached ðŸš«";
        return;
    }

    document.getElementById("reply").innerText = data.reply;
    document.getElementById("message").value = "";
}
</script>

</body>
</html>